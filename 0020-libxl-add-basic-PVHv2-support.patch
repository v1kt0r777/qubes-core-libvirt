From dea5460b451191fc33c19aae60aeab75d9d1f57d Mon Sep 17 00:00:00 2001
From: HW42 <hw42@ipsumj.de>
Date: Fri, 29 Sep 2017 05:56:55 +0200
Subject: [PATCH] libxl: add basic PVHv2 support
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit
Organization: Invisible Things Lab
Cc: Marek Marczykowski-Górecki <marmarek@invisiblethingslab.com>

Signed-off-by: Marek Marczykowski-Górecki <marmarek@invisiblethingslab.com>
---
 docs/schemas/domaincommon.rng | 2 ++
 src/conf/domain_conf.c        | 3 ++-
 src/conf/domain_conf.h        | 1 +
 src/libxl/libxl_conf.c        | 2 ++
 4 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/docs/schemas/domaincommon.rng b/docs/schemas/domaincommon.rng
index 80562c4567..04ec1087fe 100644
--- a/docs/schemas/domaincommon.rng
+++ b/docs/schemas/domaincommon.rng
@@ -3054,6 +3054,7 @@
                 <value>qemu</value>
                 <value>stubdom</value>
                 <value>stubdom-linux</value>
+                <value>none</value>
               </choice>
             </attribute>
           </optional>
@@ -3075,6 +3076,7 @@
               <value>qemu</value>
               <value>stubdom</value>
               <value>stubdom-linux</value>
+              <value>none</value>
             </choice>
           </attribute>
           <optional>
diff --git a/src/conf/domain_conf.c b/src/conf/domain_conf.c
index 9f0dea71df..68639e2913 100644
--- a/src/conf/domain_conf.c
+++ b/src/conf/domain_conf.c
@@ -860,7 +860,8 @@ VIR_ENUM_IMPL(virDomainDiskTray, VIR_DOMAIN_DISK_TRAY_LAST,
 VIR_ENUM_IMPL(virDomainEmulatorType, VIR_DOMAIN_EMULATOR_TYPE_LAST,
               "qemu",
               "stubdom",
-              "stubdom-linux");
+              "stubdom-linux",
+              "none");
 
 VIR_ENUM_IMPL(virDomainRNGModel,
               VIR_DOMAIN_RNG_MODEL_LAST,
diff --git a/src/conf/domain_conf.h b/src/conf/domain_conf.h
index d8fadb8e8e..fcd767fecd 100644
--- a/src/conf/domain_conf.h
+++ b/src/conf/domain_conf.h
@@ -2101,6 +2101,7 @@ typedef enum {
     VIR_DOMAIN_EMULATOR_TYPE_DEFAULT,
     VIR_DOMAIN_EMULATOR_TYPE_STUBDOM,
     VIR_DOMAIN_EMULATOR_TYPE_STUBDOM_LINUX,
+    VIR_DOMAIN_EMULATOR_TYPE_NONE,
 
     VIR_DOMAIN_EMULATOR_TYPE_LAST
 } virDomainEmulatorType;
diff --git a/src/libxl/libxl_conf.c b/src/libxl/libxl_conf.c
index c8d7c25e1e..cd70be3432 100644
--- a/src/libxl/libxl_conf.c
+++ b/src/libxl/libxl_conf.c
@@ -549,6 +549,8 @@ libxlMakeDomBuildInfo(virDomainDefPtr def,
                 b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_QEMU_XEN_TRADITIONAL;
             else if (def->emulator_type == VIR_DOMAIN_EMULATOR_TYPE_STUBDOM_LINUX)
                 b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_QEMU_XEN;
+            else if (def->emulator_type == VIR_DOMAIN_EMULATOR_TYPE_NONE)
+                b_info->device_model_version = LIBXL_DEVICE_MODEL_VERSION_NONE;
         }
 
         /* In case of stubdom there will be two qemu instances:
-- 
2.13.6

